<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Orange-Style Tabbed Browser ‚Äî Upgraded</title>
    <style>
        /* ---------------------- Base Reset ---------------------- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html,body { height: 100%; }
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            background: #f0f0f0;
            display: flex;
            padding: 12px;
        }

        /* ---------------------- Theme variables ---------------------- */
        :root {
            --orange-primary: #FF7043;
            --orange-dark: #F4511E;
            --ui-bg-light: #ffffff;
            --ui-bg-mid: #f9f9f9;
            --text-color: #222;
            --border-color: #e3e3e3;
            --muted: #888;
        }
        .theme-dark {
            --ui-bg-light: #121316;
            --ui-bg-mid: #141416;
            --text-color: #eaeaea;
            --border-color: #2b2b2b;
            --muted: #9a9a9a;
            background: #0f0f10;
        }
        .theme-blue {
            --orange-primary: #3B82F6;
            --orange-dark: #2563EB;
            --ui-bg-light: #ffffff;
            --ui-bg-mid: #f3f7ff;
            --text-color: #0f172a;
            --border-color: #dbeafe;
        }

        /* ---------------------- Shell ---------------------- */
        .browser-shell {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: var(--ui-bg-light);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(2,6,23,0.08);
            overflow: hidden;
        }

        /* ---------------------- Loading bar ---------------------- */
        .loading-bar-wrap { height: 3px; background: transparent; width: 100%; position: relative; }
        .loading-bar {
            height: 3px;
            width: 0%;
            background: linear-gradient(90deg, var(--orange-primary), var(--orange-dark));
            transition: width 150ms linear;
        }

        /* ---------------------- Top controls (tabs row) ---------------------- */
        .top-row { display:flex; align-items:center; gap:8px; padding:8px; background:var(--ui-bg-mid); border-bottom:1px solid var(--border-color); }
        #tabs-container { display:flex; align-items:center; gap:6px; overflow-x:auto; padding:4px; flex:1; }

        .tab-button {
            display:flex; align-items:center; gap:8px; padding:6px 10px; height:40px;
            background:var(--ui-bg-mid); border:1px solid var(--border-color); border-radius:10px; cursor:pointer; user-select:none;
            white-space:nowrap; max-width:220px; overflow:hidden; text-overflow:ellipsis; transition:transform .12s ease, box-shadow .12s ease;
        }
        .tab-button.dragging { opacity:0.5; transform:scale(0.98); }
        .tab-button:hover { transform:translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,0.06); }
        .tab-button.active { background:var(--ui-bg-light); border-bottom:3px solid var(--orange-primary); font-weight:600; }

        .tab-favicon { width:18px; height:18px; background-size:cover; background-position:center; border-radius:3px; flex-shrink:0; }
        .tab-title { font-size:13px; color:var(--text-color); overflow:hidden; text-overflow:ellipsis; }
        .tab-close { margin-left:8px; color:var(--muted); font-weight:700; cursor:pointer; }
        .tab-close:hover { color:var(--text-color); }

        .add-tab-button { border:none; background:transparent; font-size:20px; color:var(--text-color); width:36px; height:36px; border-radius:8px; cursor:pointer; }
        .add-tab-button:hover { background:rgba(0,0,0,0.04); }

        /* ---------------------- Address bar row ---------------------- */
        .address-row { display:flex; align-items:center; gap:8px; padding:10px; border-bottom:1px solid var(--border-color); }
        .nav-btn { padding:8px 12px; border-radius:999px; border:none; background:var(--orange-primary); color:white; cursor:pointer; font-weight:600; }
        .nav-btn:hover { background:var(--orange-dark); }
        .secondary-btn { background:transparent; border:1px solid var(--border-color); color:var(--text-color); padding:8px 10px; border-radius:8px; cursor:pointer; }

        #urlInput { flex:1; padding:10px 14px; border-radius:20px; border:1px solid var(--border-color); background:var(--ui-bg-mid); font-size:14px; }
        #themeSelect { margin-left:6px; padding:8px 10px; border-radius:8px; border:1px solid var(--border-color); background:transparent; }

        /* ---------------------- Content area ---------------------- */
        .content-area { flex:1; position:relative; display:flex; background:var(--ui-bg-light); }
        #iframes-container { flex:1; position:relative; }
        .iframe-tab-content { position:absolute; inset:0; display:none; }
        .iframe-tab-content.active { display:block; }
        .iframe-tab-content iframe { width:100%; height:100%; border:0; }

        /* Homepage styling */
        .homepage { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px; height:100%; text-align:center; padding:40px; background:var(--ui-bg-mid); }
        .homepage h1 { font-size:48px; color:var(--orange-dark); }
        .homepage-search-input { width:min(720px,80%); padding:14px 24px; border-radius:999px; border:2px solid var(--orange-primary); font-size:16px; }
        .homepage-links { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }
        .home-link { padding:10px 14px; border-radius:10px; background:white; border:1px solid var(--border-color); cursor:pointer; display:flex; gap:8px; align-items:center; }

        /* small utilities */
        .controls-right { display:flex; gap:8px; align-items:center; }
        .muted { color:var(--muted); font-size:13px; }

        /* responsive */
        @media (max-width:700px){ .tab-title{ display:none; } }
    </style>
</head>
<body>
    <div id="shell" class="browser-shell">
        <!-- Loading bar -->
        <div class="loading-bar-wrap"><div id="loadingBar" class="loading-bar"></div></div>

        <!-- Tabs Row -->
        <div class="top-row">
            <div id="tabs-container" aria-label="Tabs"></div>
            <button id="globalAdd" class="add-tab-button" title="New tab">+</button>
            <div class="controls-right" style="margin-left:8px;">
                <select id="themeSelect" title="Theme">
                    <option value="orange">Orange</option>
                    <option value="dark">Dark</option>
                    <option value="blue">Blue</option>
                </select>
            </div>
        </div>

        <!-- Address Row -->
        <div class="address-row">
            <button class="secondary-btn" id="backBtn">‚Üê</button>
            <button class="secondary-btn" id="forwardBtn">‚Üí</button>
            <button class="secondary-btn" id="reloadBtn">‚ü≥</button>
            <button class="secondary-btn" id="homeBtn">üè†</button>

            <input id="urlInput" placeholder="Enter URL (e.g., example.com) or search" />
            <button id="goBtn" class="nav-btn">Go</button>
        </div>

        <!-- Content -->
        <div class="content-area">
            <div id="iframes-container"></div>
        </div>
    </div>

    <script>
        // ---------------------- Global state ----------------------
        let tabs = []; // {id, url, title, isHomepage, elements: {button, favicon, title, close, content}}
        let tabIdCounter = 0;
        const tabsContainer = document.getElementById('tabs-container');
        const iframesContainer = document.getElementById('iframes-container');
        const loadingBar = document.getElementById('loadingBar');
        const globalAdd = document.getElementById('globalAdd');
        const urlInput = document.getElementById('urlInput');
        const goBtn = document.getElementById('goBtn');
        const backBtn = document.getElementById('backBtn');
        const forwardBtn = document.getElementById('forwardBtn');
        const reloadBtn = document.getElementById('reloadBtn');
        const homeBtn = document.getElementById('homeBtn');
        const themeSelect = document.getElementById('themeSelect');
        const shell = document.getElementById('shell');

        const STORAGE_KEY = 'otb_tabs_v1';

        // ---------------------- Helpers ----------------------
        function formatUrl(url){
            // detect search vs url
            if (!url) return '';
            if (/^https?:\/\//i.test(url)) return url;
            if (url.includes(' ') || !url.includes('.')) return 'https://www.google.com/search?q=' + encodeURIComponent(url);
            return 'https://' + url;
        }
        function getHostName(url){ try { return new URL(url).hostname.replace(/^www\./,''); } catch(e){ return url; } }
        function faviconFor(url){ try{ const d = new URL(url).hostname; return `https://www.google.com/s2/favicons?domain=${d}`; }catch(e){ return ''; } }

        // ---------------------- Loading bar simulation ----------------------
        let loadingTimer = null;
        function startLoading() {
            clearInterval(loadingTimer);
            loadingBar.style.width = '6%';
            loadingTimer = setInterval(()=>{
                const cur = parseFloat(loadingBar.style.width);
                const inc = Math.random() * 8 + 4; // 4-12%
                const next = Math.min(95, cur + inc);
                loadingBar.style.width = next + '%';
            }, 200);
        }
        function finishLoading(){
            clearInterval(loadingTimer);
            loadingBar.style.width = '100%';
            setTimeout(()=> loadingBar.style.width = '0%', 250);
        }

        // ---------------------- Tab Creation ----------------------
        function createNewTab(url=null, makeActive=true){
            tabIdCounter++;
            const id = 'tab-' + tabIdCounter;
            const isHomepage = !url;
            const tabUrl = isHomepage ? 'about:home' : formatUrl(url);
            const title = isHomepage ? 'New Tab' : getHostName(tabUrl);

            // Tab button element
            const btn = document.createElement('div'); btn.className = 'tab-button'; btn.draggable = true; btn.dataset.tab = id;
            const fav = document.createElement('div'); fav.className='tab-favicon'; if (!isHomepage) fav.style.backgroundImage = `url(${faviconFor(tabUrl)})`;
            const tit = document.createElement('div'); tit.className='tab-title'; tit.textContent = title;
            const close = document.createElement('div'); close.className='tab-close'; close.innerHTML='&times;';
            btn.appendChild(fav); btn.appendChild(tit); btn.appendChild(close);
            tabsContainer.insertBefore(btn, globalAdd);

            // Content wrapper
            const wrapper = document.createElement('div'); wrapper.className = 'iframe-tab-content'; wrapper.id = id;
            if (isHomepage){
                wrapper.innerHTML = `
                    <div class="homepage">
                        <h1>CAS Cloak</h1>
                        <input class="homepage-search-input" placeholder="Search or type URL" />
                        <div class="homepage-links">
                            <div class="home-link" data-url="https://www.youtube.com"><img src="https://www.google.com/s2/favicons?domain=youtube.com"/> YouTube</div>
                            <div class="home-link" data-url="https://www.roblox.com"><img src="https://www.google.com/s2/favicons?domain=roblox.com"/> Roblox</div>
                            <div class="home-link" data-url="https://www.tiktok.com"><img src="https://www.google.com/s2/favicons?domain=tiktok.com"/> TikTok</div>
                            <div class="home-link" data-url="https://www.google.com"><img src="https://www.google.com/s2/favicons?domain=google.com"/> Google</div>
                        </div>
                    </div>
                `;
            } else {
                wrapper.innerHTML = `<iframe src="${tabUrl}" allow="fullscreen"></iframe>`;
            }
            iframesContainer.appendChild(wrapper);

            const tabObj = { id, url: tabUrl, isHomepage, title, elements: { button: btn, favicon: fav, titleEl: tit, closeEl: close, contentEl: wrapper } };
            tabs.push(tabObj);

            // Event listeners
            btn.addEventListener('click', ()=> switchTab(id));
            close.addEventListener('click', (e)=>{ e.stopPropagation(); closeTab(id); });

            // Drag/reorder
            btn.addEventListener('dragstart', (e)=>{ btn.classList.add('dragging'); e.dataTransfer.setData('text/plain', id); });
            btn.addEventListener('dragend', ()=> btn.classList.remove('dragging'));
            btn.addEventListener('dragover', (e)=> e.preventDefault());
            btn.addEventListener('drop', (e)=>{
                e.preventDefault(); const fromId = e.dataTransfer.getData('text/plain'); const toId = id; reorderTabs(fromId, toId);
            });

            // Homepage interactions
            if (isHomepage){
                const input = wrapper.querySelector('.homepage-search-input');
                input.addEventListener('keypress', (e)=>{
                    if (e.key === 'Enter'){
                        const val = e.target.value.trim(); if (!val) return; loadUrlInTab(id, formatUrl(val));
                    }
                });
                wrapper.querySelectorAll('.home-link').forEach(el=> el.addEventListener('click', ()=> loadUrlInTab(id, el.dataset.url)));
            } else {
                // iframe load events
                const iframe = wrapper.querySelector('iframe');
                startLoading();
                iframe.addEventListener('load', ()=>{
                    // try to read title (may fail due to cross-origin)
                    try { const docTitle = iframe.contentDocument && iframe.contentDocument.title; if (docTitle) tabObj.title = docTitle; }catch(e){}
                    tabObj.title = getHostName(tabObj.url);
                    tabObj.elements.titleEl.textContent = tabObj.title;
                    tabObj.elements.favicon.style.backgroundImage = `url(${faviconFor(tabObj.url)})`;
                    finishLoading();
                });
                // initial favicon set (may 404 but ok)
                fav.style.backgroundImage = `url(${faviconFor(tabUrl)})`;
            }

            // Auto-activate
            if (makeActive) switchTab(id);
            saveState();
            return tabObj;
        }

        // ---------------------- Switch / Close / Reorder ----------------------
        function switchTab(id){
            tabs.forEach(t=>{
                t.elements.button.classList.toggle('active', t.id===id);
                t.elements.contentEl.classList.toggle('active', t.id===id);
            });
            const active = tabs.find(t=>t.id===id);
            if (active){ urlInput.value = active.isHomepage ? '' : active.url; }
            saveState();
        }

        function closeTab(id){
            const idx = tabs.findIndex(t=>t.id===id); if (idx === -1) return;
            const wasActive = tabs[idx].elements.button.classList.contains('active');
            // remove DOM
            tabs[idx].elements.button.remove(); tabs[idx].elements.contentEl.remove();
            tabs.splice(idx,1);
            if (tabs.length === 0) createNewTab(null);
            else if (wasActive) {
                const newIdx = Math.max(0, idx-1); switchTab(tabs[newIdx].id);
            }
            saveState();
        }

        function reorderTabs(fromId, toId){
            if (fromId === toId) return;
            const fromIdx = tabs.findIndex(t=>t.id===fromId); const toIdx = tabs.findIndex(t=>t.id===toId);
            if (fromIdx === -1 || toIdx === -1) return;
            const [item] = tabs.splice(fromIdx,1);
            tabs.splice(toIdx,0,item);
            // reorder DOM
            tabs.forEach(t=> tabsContainer.insertBefore(t.elements.button, globalAdd));
            saveState();
        }

        // ---------------------- Load / Navigation ----------------------
        function loadUrlInTab(id, url){
            const tab = tabs.find(t=>t.id===id); if (!tab) return;
            tab.url = url; tab.isHomepage = false; tab.title = getHostName(url);
            const wrapper = tab.elements.contentEl;
            wrapper.innerHTML = `<iframe src="${url}" allow="fullscreen"></iframe>`;
            tab.elements.favicon.style.backgroundImage = `url(${faviconFor(url)})`;
            tab.elements.titleEl.textContent = tab.title;

            const iframe = wrapper.querySelector('iframe'); startLoading();
            iframe.addEventListener('load', ()=>{ try{ const docTitle = iframe.contentDocument && iframe.contentDocument.title; if (docTitle) tab.title = docTitle; }catch(e){} tab.elements.titleEl.textContent = tab.title; finishLoading(); });
            switchTab(id);
            saveState();
        }

        function loadInActive(url){ const active = tabs.find(t=> t.elements.contentEl.classList.contains('active')); if (active) loadUrlInTab(active.id, url); else createNewTab(url); }

        goBtn.addEventListener('click', ()=>{ const val = urlInput.value.trim(); if (!val) return; loadInActive(formatUrl(val)); });
        urlInput.addEventListener('keypress', (e)=> { if (e.key === 'Enter') goBtn.click(); });

        backBtn.addEventListener('click', ()=>{
            const active = tabs.find(t=> t.elements.contentEl.classList.contains('active'));
            if (!active || active.isHomepage) return;
            const iframe = active.elements.contentEl.querySelector('iframe');
            try{ iframe.contentWindow.history.back(); }catch(e){ console.warn('Back blocked by cross-origin'); }
        });
        forwardBtn.addEventListener('click', ()=>{
            const active = tabs.find(t=> t.elements.contentEl.classList.contains('active'));
            if (!active || active.isHomepage) return;
            const iframe = active.elements.contentEl.querySelector('iframe');
            try{ iframe.contentWindow.history.forward(); }catch(e){ console.warn('Forward blocked by cross-origin'); }
        });
        reloadBtn.addEventListener('click', ()=>{
            const active = tabs.find(t=> t.elements.contentEl.classList.contains('active'));
            if (!active) return;
            if (active.isHomepage) return; // nothing to reload
            const iframe = active.elements.contentEl.querySelector('iframe');
            startLoading(); try{ iframe.contentWindow.location.reload(); }catch(e){ iframe.src = active.url; }
        });
        homeBtn.addEventListener('click', ()=>{
            const active = tabs.find(t=> t.elements.contentEl.classList.contains('active'));
            if (active) loadUrlInTab(active.id, null); // null -> homepage
        });

        globalAdd.addEventListener('click', ()=> createNewTab(null));

        // ---------------------- Persistence ----------------------
        function saveState(){
            try{
                const payload = tabs.map(t=> ({ id: t.id, url: t.url, isHomepage: t.isHomepage, title: t.title }));
                // also remember which is active
                const active = tabs.find(t=> t.elements.contentEl.classList.contains('active'));
                const data = { tabs: payload, activeId: active ? active.id : null, counter: tabIdCounter };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            }catch(e){ console.warn('Could not save state', e); }
        }
        function restoreState(){
            try{
                const raw = localStorage.getItem(STORAGE_KEY); if (!raw) { createNewTab(null); return; }
                const data = JSON.parse(raw); if (!data || !Array.isArray(data.tabs) || data.tabs.length===0){ createNewTab(null); return; }
                tabIdCounter = data.counter || tabIdCounter;
                data.tabs.forEach(t=> createNewTab(t.isHomepage ? null : t.url, true));
                // activate stored id
                if (data.activeId) switchTab(data.activeId); else switchTab(tabs[0].id);
            }catch(e){ console.warn('Restore failed', e); createNewTab(null); }
        }

        // ---------------------- Theme control ----------------------
        themeSelect.addEventListener('change', ()=>{
            const val = themeSelect.value;
            shell.classList.remove('theme-dark','theme-blue');
            if (val === 'dark') shell.classList.add('theme-dark');
            if (val === 'blue') shell.classList.add('theme-blue');
            try{ localStorage.setItem('otb_theme', val); }catch(e){}
        });
        function restoreTheme(){ const t = localStorage.getItem('otb_theme') || 'orange'; themeSelect.value = t; themeSelect.dispatchEvent(new Event('change')); }

        // ---------------------- Init ----------------------
        document.addEventListener('DOMContentLoaded', ()=>{
            restoreTheme(); restoreState();
            // quick click to open example link via address bar
            document.addEventListener('click', (e)=>{
                const el = e.target.closest('.home-link'); if (!el) return; const tab = tabs.find(t=> t.elements.contentEl.classList.contains('active')); if (tab) loadUrlInTab(tab.id, el.dataset.url);
            });
        });

        // Save periodically in case something changed
        setInterval(saveState, 2000);

        // expose for dev console
        window.OTB = { createNewTab, tabs };
    </script>
</body>
</html>
